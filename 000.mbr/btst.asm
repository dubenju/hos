bits 16
org  0000h

_START:
	XOR AX,AX
	MOV SS,AX
	MOV SP,0X7C00
	STI
	PUSH AX
	POP ES
	PUSH AX
	POP DS
	CLD
	MOV SI,0X7C1B
	MOV DI,0X61B
	PUSH AX
	PUSH DI
	MOV CX,0X1E5
	REP MOVSB
	RETF
_MAIN_PROC:
	MOV SI,0X7BE
	MOV CL,0X4
_CHK_ACTIVE_PARTIOTION_ENTRY:
	CMP [SI],CH
	JL _SEARCH_ACTIVE_PARTIOTION_ENTRY
	JNZ _DSP_ERROR_MSG
	add si,byte +0x10
	LOOP _CHK_ACTIVE_PARTIOTION_ENTRY
	INT 0X18
_SEARCH_ACTIVE_PARTIOTION_ENTRY:
	MOV DX,[SI]
	MOV BP,SI
_MOVE_TO_NEXT_ENTRY:
	ADD SI,BYTE +0X10
	DEC CX
	JZ _CHK_SYSTEM_ID_FOR_FAT
	CMP [SI],CH
	JZ _MOVE_TO_NEXT_ENTRY
_DSP_ERROR_MSG:
	MOV SI,0X710
_DSP_NEXT_CHAR:
	DEC SI
	LODSB
	CMP AL,0X0
	JZ _DSP_NEXT_CHAR
	MOV BX,0X7
	MOV AH,0XE
	INT 0X10
_HANG:
	JMP SHORT _HANG
_CHK_SYSTEM_ID_FOR_FAT:
	MOV [BP+0X25],AX
	XCHG AX,SI
	MOV AL,[BP+0X4]
	MOV AH,0X6
	CMP AL,0XE
	JZ 0X6B
	MOV AH,0XB
	CMP AL,0XC
	JZ 0X65
	CMP AL,AH
	JNZ 0X8F
	INC AX
	MOV BYTE [BP+0X25],0X6
	JNZ 0X8F
_CHK_EXTEND:
	MOV BX,0X55AA
	PUSH AX
	MOV AH,0X41
	INT 0X13
	POP AX
	JC 0X8C
	CMP BX,0XAA55
	JNZ 0X8C

	TEST CL,0X1
	JZ 0X8C
	MOV AH,AL
	MOV [BP+0X24],DL
	MOV WORD [0X6A1],0X1EEB
	MOV [BP+0X4],AH
	MOV DI,0XA
	MOV AX,0X201
	MOV BX,SP
	XOR CX,CX
	CMP DI,BYTE +0X05
	JG 0XA1
	MOV CX,[BP+0X25]
	ADD CX,[BP+0X2]
	INT 0X13
	JC 0XD1
	MOV SI,0X746
	CMP WORD [0X7DFE],0XAA55
	JZ 0X10D
	SUB DI,BYTE +0X05
	JG 0X92
	TEST SI,SI
	JNZ 0X3F
	MOV SI,0X727
	JMP SHORT 0X4B
	CBW
	XCHG AX,CX
	PUSH DX
	CWD
	ADD AX,[BP+0X8]
	ADC DX,[BP+0XA]
	CALL WORD 0XE0
	POP DX
	JMP SHORT 0XA6
	DEC DI
	JZ 0XB8
	XOR AX,AX
	INT 0X13
	JMP SHORT 0X92
	PUSH SI
	XOR SI,SI
	PUSH SI
	PUSH SI
	PUSH DX
	PUSH AX
	PUSH ES
	PUSH BX
	PUSH CX
	MOV SI,0X10
	PUSH SI
	MOV SI,SP
	PUSH AX
	PUSH DX
	MOV AX,0X4200
	MOV DL,[BP+0X24]
	INT 0X13
	POP DX
	POP AX
	LEA SP,[SI+0X10]
	JC 0X105
	INC AX
	JNZ 0XFF
	INC DX
	ADD BH,0X2
	LOOP 0XFB
	CLC
	POP SI
	RET
	JMP SHORT 0X17D
	